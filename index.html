<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุบุชู ุงูุซุงููุฉ. | ูุฑุดุฏ ุชุนูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        .custom-focus:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(162, 123, 92, 0.4);
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Modal Animation */
        @keyframes modal-in {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-animate {
            animation: modal-in 0.3s ease-out;
        }
        
        /* Progress Bar */
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        /* Print Styles */
        @media print {
            body { background: white; }
            .no-print { display: none; }
            .print-break { page-break-after: always; }
        }
    </style>
    <script>
        // Custom Tailwind colors configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'base': '#DCD7C9',
                        'primary': '#A27B5C',
                        'primary-dark': '#8C6B4F',
                        'text-main': '#2c3639',
                        'text-muted': '#6E5E54',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-base to-[#C3B8A8] min-h-screen">

    <div class="container mx-auto max-w-4xl my-8 md:my-12 p-6 md:p-8 bg-white/70 backdrop-blur-md rounded-3xl shadow-2xl border border-white/50">
        
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent pb-2">
                ูุบุชู ุงูุซุงููุฉ.
            </h1>
            <p class="text-base md:text-lg text-text-muted mt-2">
                ุงุญุตู ุนูู ูุตุงุฆุญ ูุฅุฑุดุงุฏุงุช ูุฎุตุตุฉ ูุจููุฉ ุนูู ุงูุนููุ ูู ุซูุงูู.
            </p>
            
            <!-- Progress Bar -->
            <div class="mt-6 bg-gray-200 rounded-full h-2 overflow-hidden">
                <div id="progress-bar" class="progress-bar bg-gradient-to-r from-primary to-primary-dark h-full w-0"></div>
            </div>
        </div>

        <!-- Input Form -->
        <form id="learning-form" class="space-y-8">
            
            <!-- Level Selection -->
            <div class="form-section">
                <label for="level" class="block mb-3 font-medium text-text-main">
                    ูุง ูู ูุณุชูุงู ุงูุญุงูู ูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ
                    <span class="text-sm text-text-muted block mt-1">ุงุฎุชุฑ ุงููุณุชูู ุงูุฃูุฑุจ ููุฏุฑุงุชู ุงูุญุงููุฉ</span>
                </label>
                <select id="level" required class="w-full p-4 bg-white/50 border border-gray-300/50 rounded-xl custom-focus transition-all duration-300 text-text-main hover:border-primary/50">
                    <option value="">-- ุงุฎุชุฑ ูุณุชูุงู --</option>
                    <option value="A1">ูุจุชุฏุฆ ุชูุงููุง (A1 - Breakthrough)</option>
                    <option value="A2">ูุจุชุฏุฆ (A2 - Waystage)</option>
                    <option value="B1">ูุชูุณุท (B1 - Threshold)</option>
                    <option value="B2">ููู ุงููุชูุณุท (B2 - Vantage)</option>
                    <option value="C1">ูุชูุฏู (C1 - Effective Proficiency)</option>
                    <option value="C2">ูุชููู (C2 - Mastery)</option>
                </select>
            </div>

            <!-- Goal Selection -->
            <div class="form-section">
                <label class="block mb-3 font-medium text-text-main">
                    ูุง ูู ูุฏูู ุงูุฃุณุงุณู ูู ุงูุชุนููุ
                    <span class="text-sm text-text-muted block mt-1">ุณูุคุซุฑ ูุฐุง ุนูู ููุน ุงููุญุชูู ูุงูููุงุฏ ุงูููุชุฑุญุฉ</span>
                </label>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <label class="goal-card relative flex flex-col items-center justify-center p-4 border-2 border-gray-300/50 rounded-xl cursor-pointer transition-all duration-300 hover:border-primary/50 has-[:checked]:border-primary has-[:checked]:bg-primary/10 has-[:checked]:shadow-md">
                        <input type="radio" name="goal" value="general" class="absolute opacity-0" checked required>
                        <svg class="w-8 h-8 mb-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <span class="font-medium text-text-main">ุฃูุฏุงู ุนุงูุฉ</span>
                    </label>
                    
                    <label class="goal-card relative flex flex-col items-center justify-center p-4 border-2 border-gray-300/50 rounded-xl cursor-pointer transition-all duration-300 hover:border-primary/50 has-[:checked]:border-primary has-[:checked]:bg-primary/10 has-[:checked]:shadow-md">
                        <input type="radio" name="goal" value="business" class="absolute opacity-0" required>
                        <svg class="w-8 h-8 mb-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span class="font-medium text-text-main">ุฃูุฏุงู ููููุฉ</span>
                    </label>
                    
                    <label class="goal-card relative flex flex-col items-center justify-center p-4 border-2 border-gray-300/50 rounded-xl cursor-pointer transition-all duration-300 hover:border-primary/50 has-[:checked]:border-primary has-[:checked]:bg-primary/10 has-[:checked]:shadow-md">
                        <input type="radio" name="goal" value="academic" class="absolute opacity-0" required>
                        <svg class="w-8 h-8 mb-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path>
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20" />
                        </svg>
                        <span class="font-medium text-text-main">ุฃูุฏุงู ุฃูุงุฏูููุฉ</span>
                    </label>
                </div>
            </div>

            <!-- Hours Input -->
            <div class="form-section">
                <label for="hours" class="block mb-3 font-medium text-text-main">
                    ูู ุณุงุนุฉ ููููู ุชุฎุตูุตูุง ุฃุณุจูุนููุงุ
                    <span class="text-sm text-text-muted block mt-1">ูู ูุงูุนููุง - ุงูุงุณุชูุฑุงุฑูุฉ ุฃูู ูู ุงููุซุงูุฉ</span>
                </label>
                <div class="flex items-center gap-4">
                    <input type="range" id="hours-slider" min="1" max="30" value="5" class="flex-1 accent-primary">
                    <input type="number" id="hours" value="5" min="1" max="30" required class="w-24 p-3 bg-white/50 border border-gray-300/50 rounded-xl custom-focus text-center text-text-main">
                    <span class="text-text-muted">ุณุงุนุฉ</span>
                </div>
                <div id="commitment-level" class="mt-2 text-sm text-text-muted text-center"></div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4">
                <button type="submit" id="generate-btn" class="flex-1 flex items-center justify-center gap-3 py-4 px-4 bg-gradient-to-r from-primary to-primary-dark text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-primary/50 transition-all duration-300">
                    <span>ุงุญุตู ุนูู ุงุณุชุดุงุฑุฉ ููุฑูุฉ</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </button>
                
                <button type="button" id="reset-btn" class="no-print px-6 py-4 border-2 border-gray-300 text-gray-600 font-medium rounded-xl hover:bg-gray-50 transition-all duration-300">
                    ุฅุนุงุฏุฉ ุชุนููู
                </button>
            </div>
        </form>

        <!-- Result -->
        <div id="result-container" class="hidden mt-12">
            <div id="result" class="fade-in p-6 bg-white/80 border-l-4 border-primary rounded-xl shadow-inner"></div>
            
            <!-- Additional Buttons -->
            <div class="no-print mt-6 flex flex-wrap gap-4 justify-center">
                <button id="save-btn" class="flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V2"></path>
                    </svg>
                    ุญูุธ ุงูุฅุฑุดุงุฏุงุช
                </button>
                
                <button id="print-btn" class="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    ุทุจุงุนุฉ
                </button>
                
                <button id="share-btn" class="flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.032 4.026a3 3 0 10-4.732 2.684 3 3 0 003.726 2.932 3 3 0 00.742-5.616h-.742m0 0a3 3 0 10-4.732-2.684m4.732 2.684h.008"></path>
                    </svg>
                    ูุดุงุฑูุฉ
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center p-4 mt-4 text-text-muted no-print">
        <p>&copy; <span id="current-year"></span> <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="hover:text-primary transition-colors">ูุบุชู ุงูุซุงููุฉ.</a></p>
    </footer>


    <!-- Custom Modal -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="modal-animate bg-white rounded-2xl shadow-xl w-full max-w-md p-6 text-center">
            <p id="modal-text" class="text-lg text-text-main mb-6"></p>
            <div id="modal-actions" class="flex justify-center gap-4">
                <!-- Buttons will be injected here -->
            </div>
        </div>
    </div>


    <script>
    // ==================== Data and Settings ====================
    const PLAN_DATA = {
        levels: {
            'A1': {
                title: 'ุฅุฑุดุงุฏุงุช ูููุณุชูู A1: ุงูุฎุทูุฉ ุงูุฃููู ูุญู ุงูุซูุฉ',
                principle: '<strong>ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:</strong> ูุฏูู ุงูุฃูู ูู ูุณุฑ ุญุงุฌุฒ ุงูุฎูู ูุจูุงุก ุนุงุฏุฉ ููููุฉ. ุงูุชุฑููุฒ ุนูู "ูุบุฉ ุงููุฌุงุฉ" (Survival Language) ุงูุชู ุชููุญู ุดุนูุฑูุง ููุฑููุง ุจุงูุฅูุฌุงุฒ ูุงูุซูุฉ.',
                focus: 'ุงูุชุฑููุฒ ุญุตุฑููุง ุนูู ุญูุธ ุงูุนุจุงุฑุงุช ุงูุฃุณุงุณูุฉ (ุงูุชุญูุงุชุ ุงูุชุนุฑูู ุจุงูููุณุ ุทูุจ ุงููุณุงุนุฏุฉ) ูููู ุงููููุงุช ุนุงููุฉ ุงูุชุฑุฏุฏ. ูุง ุชุดุบู ุจุงูู ุจุงูููุงุนุฏ ุงููุนูุฏุฉ ุงูุขู.',
                bookLevel: 'Beginner (A1)',
                alphabetNote: '<strong>๐ค ููุงุญุธุฉ ูููุฉ:</strong> ุฅุฐุง ูู ุชุชูู ุงูุฃุจุฌุฏูุฉ ุงูุฅูุฌููุฒูุฉ ุจุนุฏุ ููุตุญู ุจุดุฏุฉ ุจุงูุจุฏุก ุจุฏูุฑุฉ ุงูุฃููุจุงุฆูุฉ ุงููุฌุงููุฉ ุงููุชููุฑุฉ ุนูู <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>',
                timeEstimate: '<strong>โฑ๏ธ ุชูุฏูุฑ ุงูููุช ููุงูุชูุงู ูููุณุชูู ุงูุชุงูู:</strong> ููุนุฑูุฉ ุงููุฏุฉ ุงููุชููุนุฉ ููุงูุชูุงู ูู A1 ุฅูู A2 ุจูุงุกู ุนูู ุงูุฃุจุญุงุซ ุงูุนูููุฉ ูุนุฏุฏ ุณุงุนุงุช ุฏุฑุงุณุชู ุงูุฃุณุจูุนูุฉุ ูู ุจุฒูุงุฑุฉ <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>'
            },
            'A2': {
                title: 'ุฅุฑุดุงุฏุงุช ูููุณุชูู A2: ุจูุงุก ุงูุฌุณูุฑ ุงููุบููุฉ',
                principle: '<strong>ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:</strong> ููุฏ ุชุฌุงูุฒุช ูุฑุญูุฉ "ุงููุฌุงุฉ". ุงูุขู ูุฏูู ูู ุงูุจุฏุก ูู ุฑุจุท ุงูุฃููุงุฑ ูุชูููู ุฌูู ุจุณูุทุฉ ุจููุณู. ุณุชุจุฏุฃ ูู ุงูุงูุชูุงู ูู ูุฌุฑุฏ ุชุฑุฏูุฏ ุงูุนุจุงุฑุงุช ุงููุญููุธุฉ ุฅูู ุงูุชุนุจูุฑ ุนู ุฃููุงุฑู ุงูุฎุงุตุฉ.',
                focus: 'ุงูุชุฑููุฒ ุนูู ููู ุงูุฌูู ุงููุชุนููุฉ ุจุงูููุงุถูุน ุงูุดุฎุตูุฉ ุงููุจุงุดุฑุฉ (ุงูุนุงุฆูุฉุ ุงูุนููุ ุงูุชุณูู). ุณุชุจุฏุฃ ูู ููุงุฑุณุฉ ุงููุญุงุฏุซุงุช ุงููุตูุฑุฉ ุงูุชู ุชุชุทูุจ ุชุจุงุฏููุง ุจุณูุทูุง ููุจุงุดุฑูุง ูููุนูููุงุช.',
                bookLevel: 'Elementary (A2)',
                timeEstimate: '<strong>โฑ๏ธ ุชูุฏูุฑ ุงูููุช ููุงูุชูุงู ูููุณุชูู ุงูุชุงูู:</strong> ููุนุฑูุฉ ุงููุฏุฉ ุงููุชููุนุฉ ููุงูุชูุงู ูู A2 ุฅูู B1 ุจูุงุกู ุนูู ุงูุฃุจุญุงุซ ุงูุนูููุฉ ูุนุฏุฏ ุณุงุนุงุช ุฏุฑุงุณุชู ุงูุฃุณุจูุนูุฉุ ูู ุจุฒูุงุฑุฉ <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>'
            },
            'B1': {
                title: 'ุฅุฑุดุงุฏุงุช ูููุณุชูู B1: ุนุชุจุฉ ุงูุงุณุชููุงู ุงููุบูู',
                principle: '<strong>ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:</strong> ูุฐู ูู ุฃูู ูุฑุญูุฉ ุงูุชูุงููุฉ. ูุฏูู ูู ุฃู ุชุตุจุญ "ูุณุชุฎุฏููุง ูุณุชููุงู" ููุบุฉ. ูุฌุจ ุฃู ุชูุชูู ูู ุงูุงุนุชูุงุฏ ุนูู ุงูููุงุฏ ุงูุชุนููููุฉ ุงููุจุณุทุฉ ุฅูู ุงูุชุนุงูู ูุน ุงููุบุฉ ุงูุญููููุฉ ูู ุงูููุงุถูุน ุงููุฃูููุฉ.',
                focus: 'ุงูุชุฑููุฒ ุนูู ููู ุงูููุงุท ุงูุฑุฆูุณูุฉ ุนูุฏ ุงูุงุณุชูุงุน ุฃู ุงููุฑุงุกุฉ ูููุงุถูุน ูุงุถุญุฉ ููุฃูููุฉ. ุงููุฏู ุงูุฃูุจุฑ ูู ุงููุฏุฑุฉ ุนูู ูุตู ุงูุชุฌุงุฑุจ ูุงูุฃุญุฏุงุซ ูุฅุนุทุงุก ุฃุณุจุงุจ ูุขุฑุงุก ุจุณูุทุฉ.',
                bookLevel: 'Intermediate (B1)',
                timeEstimate: '<strong>โฑ๏ธ ุชูุฏูุฑ ุงูููุช ููุงูุชูุงู ูููุณุชูู ุงูุชุงูู:</strong> ููุนุฑูุฉ ุงููุฏุฉ ุงููุชููุนุฉ ููุงูุชูุงู ูู B1 ุฅูู B2 ุจูุงุกู ุนูู ุงูุฃุจุญุงุซ ุงูุนูููุฉ ูุนุฏุฏ ุณุงุนุงุช ุฏุฑุงุณุชู ุงูุฃุณุจูุนูุฉุ ูู ุจุฒูุงุฑุฉ <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>'
            },
            'B2': {
                title: 'ุฅุฑุดุงุฏุงุช ูููุณุชูู B2: ุงูุงูุทูุงู ูุญู ุงูุทูุงูุฉ',
                principle: '<strong>ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:</strong> ูุฏูู ุงูุขู ูู ุงูุทูุงูุฉ ูุงูุนูููุฉ. ูุฌุจ ุฃู ุชุชููู ูู ุงูุชูุงุนู ูุน ุงููุงุทููู ุงูุฃุตูููู ุฏูู ุฃู ูุดุนุฑ ุฃู ูู ุงูุทุฑููู ุจุถุบุท ุฃู ุฅุฑูุงู. ูุฐุง ูุชุทูุจ ุจูุงุก ุณุฑุนุฉ ูู ุงูููู ูุงูุฅูุชุงุฌ.',
                focus: 'ุงูุชุฑููุฒ ุนูู ููู ุงูุฃููุงุฑ ุงูุฑุฆูุณูุฉ ูููุตูุต ุงููุนูุฏุฉ ูู ููุงุถูุน ูุชููุนุฉุ ุจูุง ูู ุฐูู ูุฌุงูู ุงูุชุฎุตุตู. ุงููุฏู ูู ุงูุชูุงุนู ุจุฏุฑุฌุฉ ูู ุงูุทูุงูุฉ ูุงูุนูููุฉ ุชุฌุนู ุงููุญุงุฏุซุงุช ุงูุนุงุฏูุฉ ููููุฉ ููุฑูุญุฉ.',
                bookLevel: 'Upper-Intermediate (B2)',
                timeEstimate: '<strong>โฑ๏ธ ุชูุฏูุฑ ุงูููุช ููุงูุชูุงู ูููุณุชูู ุงูุชุงูู:</strong> ููุนุฑูุฉ ุงููุฏุฉ ุงููุชููุนุฉ ููุงูุชูุงู ูู B2 ุฅูู C1 ุจูุงุกู ุนูู ุงูุฃุจุญุงุซ ุงูุนูููุฉ ูุนุฏุฏ ุณุงุนุงุช ุฏุฑุงุณุชู ุงูุฃุณุจูุนูุฉุ ูู ุจุฒูุงุฑุฉ <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>'
            },
            'C1': {
                title: 'ุฅุฑุดุงุฏุงุช ูููุณุชูู C1: ุงูููุงุกุฉ ุงููุนุงูุฉ ูุงููุฑููุฉ',
                principle: '<strong>ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:</strong> ูู ูุนุฏ ุงูุฃูุฑ ูุชุนูู ุจุงูุชูุงุตู ููุทุ ุจู ุจูุฏู ูุนุงููุฉ ููุฑููุฉ ูุฐุง ุงูุชูุงุตู. ูุฏูู ูู ููู ูุง ูู "ุจูู ุงูุณุทูุฑ" (ุงููุนูู ุงูุถููู) ูุงุณุชุฎุฏุงู ุงููุบุฉ ุจูุฑููุฉ ูู ุณูุงูุงุช ูุฎุชููุฉ.',
                focus: 'ุงูุชุฑููุฒ ุนูู ููู ูุฌููุนุฉ ูุงุณุนุฉ ูู ุงููุตูุต ุงูุทูููุฉ ูุงูุตุนุจุฉุ ูุงูุชุนุฑู ุนูู ุงููุนุงูู ุงูุถูููุฉ. ุงููุฏู ูู ุงูุชุนุจูุฑ ุนู ููุณู ุจุทูุงูุฉ ูุนูููุฉ ุฏูู ุจุญุซ ูุงุถุญ ุนู ุงููููุงุช.',
                bookLevel: '',
                timeEstimate: '<strong>โฑ๏ธ ุชูุฏูุฑ ุงูููุช ููุงูุชูุงู ูููุณุชูู ุงูุชุงูู:</strong> ููุนุฑูุฉ ุงููุฏุฉ ุงููุชููุนุฉ ููุงูุชูุงู ูู C1 ุฅูู C2 ุจูุงุกู ุนูู ุงูุฃุจุญุงุซ ุงูุนูููุฉ ูุนุฏุฏ ุณุงุนุงุช ุฏุฑุงุณุชู ุงูุฃุณุจูุนูุฉุ ูู ุจุฒูุงุฑุฉ <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>'
            },
            'C2': {
                title: 'ุฅุฑุดุงุฏุงุช ูููุณุชูู C2: ุงูุฅุชูุงู ูุงูุฏูุฉ',
                principle: '<strong>ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:</strong> ุฃูุช ุงูุขู ูู ูุฑุญูุฉ ุตูู ุงูููุงุฑุงุช ูููุตูู ุฅูู ูุณุชูู ูุดุจู ุงููุงุทู ุงูุฃุตูู ุงููุชุนูู. ุงููุฏู ูู ุงูุฏูุฉ ุงููุงููุฉุ ูููู ุงููุฑูู ุงูุฏูููุฉ ุฌุฏูุง ูู ุงููุนูู.',
                focus: 'ุงูุชุฑููุฒ ูู ููู ูู ูุง ููุณูุน ุฃู ูููุฑุฃ ุจุณูููุฉ ุชุงูุฉ. ุงููุฏู ูู ุงูุชุนุจูุฑ ุนู ุงูููุณ ุจุนูููุฉ ูุทูุงูุฉ ูุฏูุฉ ูุงุฆูุฉุ ูุน ุงูุชูููุฒ ุจูู ุงููุฑูู ุงูุฏูููุฉ ูู ุงููุนูู.',
                bookLevel: '',
                timeEstimate: '<strong>๐ฏ ุชูุงูููุง!</strong> ููุฏ ูุตูุช ุฅูู ุฃุนูู ูุณุชูู ูู ุฅุชูุงู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ. ูููุฒูุฏ ูู ุงูููุงุฑุฏ ุงููุชูุฏูุฉ ูุงููุตุงุฆุญ ููุญูุงุธ ุนูู ูุณุชูุงูุ ูู ุจุฒูุงุฑุฉ <a href="https://www.my2ndlang.blog" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline font-bold">ูููุน ูุบุชู ุงูุซุงููุฉ.</a>'
            }
        }
    };

    // ==================== Helper Functions ====================
    
    /**
     * Shows a custom modal with a message and action buttons.
     * @param {string} text - The message to display.
     * @param {Array<Object>} actions - Array of action objects {label, class, callback}.
     */
    function showModal(text, actions = []) {
        const modal = document.getElementById('custom-modal');
        document.getElementById('modal-text').textContent = text;
        const actionsContainer = document.getElementById('modal-actions');
        actionsContainer.innerHTML = ''; // Clear previous actions

        if (actions.length === 0) {
            // Default "OK" button if no actions are provided
            actions.push({
                label: 'ุญุณููุง',
                class: 'bg-primary text-white',
                callback: () => {}
            });
        }

        actions.forEach(action => {
            const button = document.createElement('button');
            button.textContent = action.label;
            button.className = `px-6 py-2 rounded-lg font-medium transition-transform transform hover:scale-105 ${action.class}`;
            button.onclick = () => {
                modal.classList.add('hidden');
                if (action.callback) {
                    action.callback();
                }
            };
            actionsContainer.appendChild(button);
        });

        modal.classList.remove('hidden');
    }

    function updateProgressBar(step) {
        const totalSteps = 3;
        const progress = (step / totalSteps) * 100;
        document.getElementById('progress-bar').style.width = progress + '%';
    }

    function updateHoursDisplay(value) {
        document.getElementById('hours').value = value;
        updateCommitmentLevel(value);
    }

    function updateHoursSlider(value) {
        value = Math.min(30, Math.max(1, value));
        document.getElementById('hours-slider').value = value;
        updateCommitmentLevel(value);
    }

    function updateCommitmentLevel(hours) {
        const levelElement = document.getElementById('commitment-level');
        let level = '';
        let color = '';
        
        if (hours <= 4) {
            level = '๐ก ุงูุชุฒุงู ููุฎูุถ - ุงูุชุฑููุฒ ุนูู ุจูุงุก ุงูุนุงุฏุฉ';
            color = 'text-yellow-600';
        } else if (hours <= 10) {
            level = 'โก ุงูุชุฒุงู ูุนุชุฏู - ุชูุฏู ุซุงุจุช ูุชููุน';
            color = 'text-blue-600';
        } else if (hours <= 20) {
            level = '๐ ุงูุชุฒุงู ุนุงูู - ุชูุฏู ุณุฑูุน';
            color = 'text-green-600';
        } else {
            level = '๐ฅ ุงูุบูุงุณ ูุงูู - ุชุญูู ุฌุฐุฑู';
            color = 'text-red-600';
        }
        
        levelElement.className = `mt-2 text-sm text-center font-medium ${color}`;
        levelElement.textContent = level;
    }
    
    function getGoalAdvice(goal, level) {
        const isBeginnerLevel = ['A1', 'A2'].includes(level);
        const isIntermediateLevel = ['B1', 'B2'].includes(level);
        
        if (goal === 'general') {
            if (isBeginnerLevel) {
                return '<strong>ููุณุฉ ุดุฎุตูุฉ:</strong> ุงุจุฏุฃ ุจููุงุถูุน ุชุญุจูุง: ุฅุฐุง ุชุญุจ ูุฑุฉ ุงููุฏูุ ุชุนูู ุฃุณูุงุก ุงููุงุนุจูู ูุงููุฑู ุจุงูุฅูุฌููุฒูุฉ. ุฅุฐุง ุชุญุจ ุงูุทุจุฎุ ุชุนูู ุฃุณูุงุก ุงูุฃุทุนูุฉ ูุงูุฃุฏูุงุช. ุงูุดุบู ูุฌุนู ุงูุชุนูู ุฃุณูู!';
            } else if (isIntermediateLevel) {
                return '<strong>ููุณุฉ ุดุฎุตูุฉ:</strong> ุงุฌุนู ููุงูุงุชู ูุงูุชูุงูุงุชู ูุญูุฑ ุชุนููู. ุดุงูุฏ ููุฏูููุงุช ููุชููุจ ุนู ููุงูุงุชูุ ุงูุถู ูููุชุฏูุงุช ุนู ุงูุชูุงูุงุชูุ ูุงูุฑุฃ ููุงูุงุช ูู ูุฌุงูุงุช ุชุญุจูุง.';
            } else {
                return '<strong>ููุณุฉ ุดุฎุตูุฉ:</strong> ุชุนูู ูู ูุฌุงูุงุช ุดุบูู. ุงูุฑุฃ ูุชุจูุง ูุชุฎุตุตุฉุ ุดุงูุฏ ูุซุงุฆููุงุช ูุนูุฏุฉุ ูุดุงุฑู ูู ููุงุดุงุช ุนูููุฉ ุญูู ุงูุชูุงูุงุชู.';
            }
        } else if (goal === 'business') {
            if (level === 'A1') {
                return '<strong>ููุณุฉ ููููุฉ ูููุจุชุฏุฆูู:</strong> ุฑูุฒ ุนูู ุงูุฃุณุงุณูุงุช ุงูููููุฉ ุงูุจุณูุทุฉ: ุงูุฃุฑูุงูุ ุฃูุงู ุงูุฃุณุจูุนุ ุงูุชุญูุงุช ุงูุฑุณููุฉุ ุงููุณููุงุช ุงููุธูููุฉ ุงูุจุณูุทุฉ (manager, secretary, office). ูุง ุชููู ุจุดุฃู ุงููุฑุงุกุงุช ุงููุนูุฏุฉ ุงูุขู!';
            } else if (level === 'A2') {
                return '<strong>ููุณุฉ ููููุฉ ูููุณุชูู ุงูุฃุณุงุณู:</strong> ุชุนูู ุงูุนุจุงุฑุงุช ุงูุฃุณุงุณูุฉ ููุนูู: ููู ุชุฌูุจ ุงููุงุชูุ ููู ุชูุชุจ ุฅูููู ุจุณูุท ุฌุฏูุงุ ููู ุชุนุฑู ุนู ูุธููุชู ูู ุฌููุชูู. ุงุณุชุฎุฏู ุชุทุจููุงุช ูุซู "Business English for Beginners".';
            } else if (isIntermediateLevel) {
                return '<strong>ููุณุฉ ููููุฉ:</strong> ุงุจุฏุฃ ุจูุฑุงุกุฉ ููุงูุงุช ุฃุนูุงู ูุจุณุทุฉ ูู BBC Learning English ุฃู VOA Business. ุงุณุชูุน ูุจูุฏูุงุณุช ูููุชุนูููู ูุซู "Business English Pod". ุดุงูุฏ ููุฏูููุงุช TED ูุตูุฑุฉ ูุน ุงูุชุฑุฌูุฉ.';
            } else {
                return '<strong>ููุณุฉ ููููุฉ ูุชูุฏูุฉ:</strong> ุงูุขู ููููู ูุฑุงุกุฉ The Wall Street Journal ูHarvard Business Review. ุงุณุชูุน ูุจูุฏูุงุณุช ูุชุฎุตุตุฉ ูู ูุฌุงููุ ูุดุงูุฏ ุนุฑูุถูุง ุชูุฏูููุฉ ูู ูุคุชูุฑุงุช ุงุญุชุฑุงููุฉ.';
            }
        } else { // academic
            if (level === 'A1') {
                return '<strong>ููุณุฉ ุฃูุงุฏูููุฉ ูููุจุชุฏุฆูู:</strong> ุฑูุฒ ุนูู ุฃุณุงุณูุงุช ุงูุฏุฑุงุณุฉ: ุฃุณูุงุก ุงูุฃุฏูุงุช ุงููุฏุฑุณูุฉุ ุงูุฃููุงูุ ุงูุฃุดูุงูุ ุงูุฃุฑูุงู. ุชุนูู ููู ุชููู "I am a student" ู"I study..."ุ ูุงุญูุธ ุฃุณูุงุก ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ ุงูุฃุณุงุณูุฉ.';
            } else if (level === 'A2') {
                return '<strong>ููุณุฉ ุฃูุงุฏูููุฉ ุฃุณุงุณูุฉ:</strong> ุชุนูู ููู ุชุตู ุฌุฏููู ุงูุฏุฑุงุณูุ ููู ุชุทูุจ ุงููุณุงุนุฏุฉ ูู ุงููุนููุ ูููู ุชููู ุงูุชุนูููุงุช ุงูุจุณูุทุฉ. ุงูุฑุฃ ูุตุตูุง ูุตูุฑุฉ ุฌุฏูุง ูููุชุนูููู.';
            } else if (isIntermediateLevel) {
                return '<strong>ููุณุฉ ุฃูุงุฏูููุฉ:</strong> ุงุจุฏุฃ ุจูุฑุงุกุฉ ููุงูุงุช ุนูููุฉ ูุจุณุทุฉ ูู "Science for Kids" ุฃู "National Geographic Kids". ุชุนูู ููู ุชูุชุจ ููุฑุฉ ููุธูุฉ ูููู ุชูุฎุต ูุตูุง ุจุณูุทูุง.';
            } else {
                return '<strong>ููุณุฉ ุฃูุงุฏูููุฉ ูุชูุฏูุฉ:</strong> ุงูุบูุณ ูู ุงูููุงุฏ ุงูุฃูุงุฏูููุฉ ุงูุญููููุฉ. ุงูุฑุฃ ุฃุจุญุงุซูุง ูู ูุฌุงููุ ุดุงูุฏ ูุญุงุถุฑุงุช ุฌุงูุนูุฉ ุนูู Courseraุ ูุชุฏุฑุจ ุนูู ูุชุงุจุฉ ุงูููุงูุงุช ุงูุฃูุงุฏูููุฉ. ุฑูุฒ ุนูู Academic Word List (AWL).';
            }
        }
    }

    function getTimeStrategy(hours, level) {
        const isBeginnerLevel = ['A1', 'A2'].includes(level);
        const isIntermediateLevel = ['B1', 'B2'].includes(level);
        
        let strategy = {};
        
        if (hours <= 4) {
            strategy.title = `ุงุณุชุฑุงุชูุฌูุฉ ุงูุงูุชุฒุงู ุงูููุฎูุถ (${hours} ุณุงุนุงุช/ุฃุณุจูุน)`;
            strategy.description = 'ูุน ุฌุฏูู ูุฒุฏุญูุ ุงูุงุณุชูุฑุงุฑูุฉ ุฃูู ูู ุงููุซุงูุฉ. ุฑูุฒ ุนูู ุจูุงุก ุนุงุฏุฉ ููููุฉ ุตุบูุฑุฉ ูุง ูููู ุชูููุชูุง.';
            
            if (isBeginnerLevel) {
                strategy.activities = [
                    '<strong>ุงูุนุงุฏุฉ ุงูููููุฉ (15 ุฏูููุฉ):</strong> ุงุฌุนู "ุชูุฑูู ุงูุฐุงูุฑุฉ ุงูุฐูู" (SRS) ูู ูุดุงุทู ุงููููู ุงูุฃุณุงุณู ุจุงุณุชุฎุฏุงู Anki ุฃู Memrise.',
                    '<strong>ุงูุฌูุณุฉ ุงูุฃุณุจูุนูุฉ (1-2 ุณุงุนุฉ):</strong> ุฎุตุต ูุฐู ุงูุฌูุณุฉ ูู "ุงูุงุณุชูุงุน ูุงููุฑุงุกุฉ ุงูููุชุนุฉ" ูู ููุถูุน ูุงุญุฏ ูุฒูุงุฏุฉ ุงูุชุฑููุฒ.',
                    '<strong>ูุตูุญุฉ ุฐูุจูุฉ:</strong> ูุง ุชููู ุจุดุฃู ุงูุชุญุฏุซ ุงูุขู. ุฑูุฒ 100% ุนูู ุจูุงุก ุงูููุฑุฏุงุช ูุงูููู.'
                ];
            } else if (isIntermediateLevel) {
                strategy.activities = [
                    '<strong>ุงูุนุงุฏุฉ ุงูููููุฉ (15-20 ุฏูููุฉ):</strong> ุงุณุชูุน ุฅูู ุจูุฏูุงุณุช ูุตูุฑ ุฃู ุงูุฑุฃ ููุงูุงู ุฅุฎุจุงุฑููุง ุฃุซูุงุก ุชูููุงุชู.',
                    '<strong>ุงูุฌูุณุฉ ุงูุฃุณุจูุนูุฉ (2-3 ุณุงุนุงุช):</strong> ุงุฎุชุฑ "ูุดุฑูุนูุง" ุตุบูุฑูุง ูุงุญุฏูุง ููุฃุณุจูุน.',
                    '<strong>ูุตูุญุฉ:</strong> ุงุณุชุฎุฏู ุงููุบุฉ ุจุดูู ุณูุจู ุฎูุงู ุงูุฃุณุจูุน ูุจุดูู ูุดุท ูู ุฌูุณุชู ุงููุฑูุฒุฉ.'
                ];
            } else {
                strategy.activities = [
                    '<strong>ุงูุชุฑููุฒ ุงููููู:</strong> ุงุฎุชุฑ ุฌุงูุจูุง ูุงุญุฏูุง ุฏููููุง ููุชุญุณูู ูู ููู.',
                    '<strong>ุงููุฑุงุฌุนุฉ ุงูุฃุณุจูุนูุฉ:</strong> ุณุฌู ููุณู ูุญูู ููุงุท ุงูุถุนู.',
                    '<strong>ุงูุชุญุฏู ุงูุดูุฑู:</strong> ุงุฎุชุฑ ููุถูุนูุง ูุนูุฏูุง ูุงูุชุจ ุนูู ููุงูุงู ุงุญุชุฑุงูููุง.'
                ];
            }
        } else if (hours <= 10) {
            strategy.title = `ุงุณุชุฑุงุชูุฌูุฉ ุงูุงูุชุฒุงู ุงููุนุชุฏู (${hours} ุณุงุนุงุช/ุฃุณุจูุน)`;
            strategy.description = 'ูุฐุง ููุช ููุชุงุฒ ูุชุญููู ุชูุฏู ุซุงุจุช. ููููู ุจูุงุก ุนุงุฏุฉ ููููุฉ ูููุฉ ูุน ุชุฎุตูุต ููุช ูุงูู ููููุงุฑุณุฉ ุงูุชูุงุนููุฉ.';
            
            if (isBeginnerLevel) {
                strategy.activities = [
                    '<strong>ุชูุฑูู ุงูุฐุงูุฑุฉ ุงูุฐูู (10-15 ุฏูููุฉ ูููููุง):</strong> ุงุณุชุฎุฏู ุชุทุจููุงุช ุงูุจุทุงูุงุช ุงูุชุนููููุฉ ูุจูุงุก ููุฑุฏุงุชู.',
                    '<strong>ุงูุงุณุชูุงุน ูุงููุฑุงุกุฉ ุงูููุชุนุฉ (30-40 ุฏูููุฉ ูููููุง):</strong> ูุฐุง ูู "ุงูุบุฐุงุก" ุงูุฐู ูููู ูุบุชู ุจุดูู ุทุจูุนู.',
                    '<strong>ุชุฏุฑูุจ ุขูู ุนูู ุงููุญุงุฏุซุฉ (ูุฑุฉ ูุงุญุฏุฉ ุฃุณุจูุนููุง):</strong> ุชุฏุฑุจ ุนูู ุญูุงุฑุงุช ุจุณูุทุฉ ูุจูุงุก ุงูุซูุฉ.'
                ];
            } else if (isIntermediateLevel) {
                strategy.activities = [
                    '<strong>ุงูุบูุต ูู ุงูุนุงูู ุงูุญูููู (45-60 ุฏูููุฉ ูููููุง):</strong> ูุนุธู ููุชู ููุงุณุชูุงุน ูุงููุฑุงุกุฉ ูููุงุฏ ุญููููุฉ.',
                    '<strong>ุชุทุจูู "ุฎูุท ุงูุฃูุฑุงู":</strong> ุจุนุฏ ูุดุงูุฏุฉ ููุทุนุ ุญุงูู ุชูุฎูุตู ูุตุฏูู.',
                    '<strong>ุญููู ุงููุนุฑูุฉ ุฅูู ููุงุฑุฉ (ูุฑุชูู ุฃุณุจูุนููุง):</strong> ุฎุตุต ููุชูุง ูููุชุงุจุฉ ุฃู ุงูุชุญุฏุซ.'
                ];
            } else {
                strategy.activities = [
                    '<strong>ุงูููุงุฑุณุฉ ุงููุชุนูุฏุฉ (ูููููุง):</strong> ุงุฎุชุฑ ููุงุฑุฉ ุฏูููุฉ ููุชุฑููุฒ ุนูููุง ูู ููู.',
                    '<strong>ุงุตุทูุงุฏ ุงูุฃุฎุทุงุก ุงูุนููุฏุฉ (ูุฑุชูู ุฃุณุจูุนููุง):</strong> ุณุฌู ุตูุชู ูุญูู ุงูุฃุฎุทุงุก.',
                    '<strong>ูู "ูุฏุฑุจ ููุณู":</strong> ุถุน ุฃูุฏุงููุง ุตุบูุฑุฉ ููููู ุฃุฏุงุกู.'
                ];
            }
        } else {
            strategy.title = `ุงุณุชุฑุงุชูุฌูุฉ ุงูุงูุชุฒุงู ุงูุนุงูู ุฃู ุงูุงูุบูุงุณ (${hours} ุณุงุนุงุช/ุฃุณุจูุน)`;
            strategy.description = 'ูุน ูุฐุง ุงูููุชุ ููููู ุชุณุฑูุน ุชูุฏูู ุจุดูู ูุจูุฑ. ุงููุฏู ูู ุฏูุฌ ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ูู ูู ุฌุงูุจ ูู ุฌูุงูุจ ูููู.';
            
            strategy.activities = [
                '<strong>ุฑูุชูู ุงูุตุจุงุญ (60-90 ุฏูููุฉ):</strong> ุงุจุฏุฃ ูููู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุจุงููุงูู.',
                '<strong>ุฏูุฌ ุงูููุงู (ุทูุงู ุงูููู):</strong> ุบููุฑ ูุบุฉ ูู ุฃุฌูุฒุชู ูุดุงูุฏ ุงูุชุฑููู ุจุงูุฅูุฌููุฒูุฉ ููุท.',
                '<strong>ุงูุฏุฑุงุณุฉ ุงููุฑูุฒุฉ (1-2 ุณุงุนุฉ ูููููุง):</strong> ููุช ููุนูู ุงูุนููู ูุงูุชุญููู.',
                '<strong>ุงูุชูุงุนู ุงูุงุฌุชูุงุนู (ูููููุง):</strong> ุงุจุญุซ ุจูุดุงุท ุนู ูุฑุต ููุชุญุฏุซ ูุงูุชูุงุตู.'
            ];
        }
        
        return strategy;
    }

    function addSpecialResources(level, activities) {
        const bookLevel = PLAN_DATA.levels[level].bookLevel;
        
        if (bookLevel) {
            activities.push(
                `<strong>ุงูุชุฑุงุญ ูุตุฏุฑ ูููุฑุงุกุฉ:</strong> ููุนุซูุฑ ุนูู ูุชุจ ููุงุณุจุฉุ ุชุตูุญ ูููุน <a href="https://english-e-reader.net/" target="_blank" class="text-primary hover:underline">english-e-reader.net</a>. ุฑูุฒ ุนูู ูุณู <strong>${bookLevel}</strong>.`
            );
        }
        
        if (['B1', 'B2', 'C1', 'C2'].includes(level)) {
            activities.push(
                '<strong>ุฃุฏุงุฉ ุญุฏูุซุฉ ููุชุญุฏุซ:</strong> ุงุณุชุฎุฏู ููุฒุฉ ุงููุญุงุฏุซุฉ ุงูุตูุชูุฉ ุงููุฌุงููุฉ ูู ุชุทุจูู ChatGPT ุนูู ูุงุชูู ูููุงุฑุณุฉ ุงูุชุญุฏุซ ูู ุจูุฆุฉ ุขููุฉ ูุชูุงุนููุฉ.'
            );
        }
        
        return activities;
    }

    // ==================== Main Function ====================
    
    function generatePlan() {
        // Validate inputs
        const level = document.getElementById('level').value;
        const goal = document.querySelector('input[name="goal"]:checked')?.value;
        const hours = parseInt(document.getElementById('hours').value, 10);
        
        if (!level || !goal || !hours || hours < 1 || hours > 100) {
            showModal('ุงูุฑุฌุงุก ุงูุชุฃูุฏ ูู ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ุจุดูู ุตุญูุญ.');
            return;
        }
        
        // Update progress bar
        updateProgressBar(3);
        
        // Show loading indicator
        const generateBtn = document.getElementById('generate-btn');
        const originalContent = generateBtn.innerHTML;
        generateBtn.innerHTML = '<span>ุฌุงุฑู ุงูุฅุนุฏุงุฏ...</span><svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
        generateBtn.disabled = true;
        
        // Simulate delay for better UX
        setTimeout(() => {
            // Build the plan
            const levelData = PLAN_DATA.levels[level];
            const goalAdvice = getGoalAdvice(goal, level);
            const timeStrategy = getTimeStrategy(hours, level);
            
            let activities = [...timeStrategy.activities];
            activities = addSpecialResources(level, activities);
            activities.push(goalAdvice);
            
            // Build HTML
            let html = `
                <div class="space-y-6">
                    <h3 class="text-2xl font-bold text-text-main mb-4">${levelData.title}</h3>
                    
                    ${level === 'A1' && levelData.alphabetNote ? `
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        ${levelData.alphabetNote}
                    </div>
                    ` : ''}
                    
                    <div class="p-4 bg-primary/10 rounded-lg text-text-main">
                        ${levelData.principle}
                    </div>
                    
                    <div>
                        <strong class="font-medium text-text-main">ุงูุชุฑููุฒ ุงูุฃุณุงุณู:</strong>
                        <span class="text-text-muted">${levelData.focus}</span>
                    </div>
                    
                    <div>
                        <strong class="font-medium text-text-main">${timeStrategy.title}:</strong>
                        <span class="text-text-muted">${timeStrategy.description}</span>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-text-main mb-3">ุฃูุดุทุฉ ููุชุฑุญุฉ:</h4>
                        <ul class="list-disc list-inside space-y-3 text-text-muted">
                            ${activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        ${levelData.timeEstimate}
                    </div>
                </div>
            `;
            
            // Display result
            document.getElementById('result').innerHTML = html;
            document.getElementById('result-container').classList.remove('hidden');
            
            // Scroll to result
            document.getElementById('result-container').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // Save guidance to localStorage
            const guidanceData = {
                level,
                goal,
                hours,
                createdAt: new Date().toISOString()
            };
            localStorage.setItem('englishLearningGuidance', JSON.stringify(guidanceData));
            
            // Restore button state
            generateBtn.innerHTML = originalContent;
            generateBtn.disabled = false;
        }, 500);
    }
    
    // ==================== Additional Functions ====================
    
    function performReset() {
        document.getElementById('learning-form').reset();
        document.getElementById('result-container').classList.add('hidden');
        document.getElementById('progress-bar').style.width = '0%';
        document.getElementById('commitment-level').textContent = '';
        updateHoursDisplay(5);
        updateHoursSlider(5);
    }

    function savePlan() {
        const planContent = document.getElementById('result').innerHTML;
        if (!planContent) {
            showModal('ูุง ุชูุฌุฏ ุฅุฑุดุงุฏุงุช ูุญูุธูุง. ูุฑุฌู ุฅูุดุงุก ุฎุทุฉ ุฃููุงู.');
            return;
        }
        const blob = new Blob([`
            <!DOCTYPE html>
            <html lang="ar" dir="rtl">
            <head>
                <meta charset="UTF-8">
                <title>ุฎุทุชู ุงูุชุนููููุฉ ูู ูุบุชู ุงูุซุงููุฉ.</title>
                <style>
                    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; direction: rtl; line-height: 1.6; color: #333; }
                    .container { max-width: 800px; margin: 0 auto; }
                    h3 { color: #A27B5C; }
                    ul { list-style-type: disc; padding-right: 20px; }
                    a { color: #A27B5C; text-decoration: none; }
                    strong { color: #2c3639; }
                </style>
            </head>
            <body>
                <div class="container">
                    ${planContent}
                </div>
            </body>
            </html>
        `], { type: 'text/html' });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ุฎุทุฉ-ูุบุชู-ุงูุซุงููุฉ-${new Date().toLocaleDateString('ar')}.html`;
        a.click();
        URL.revokeObjectURL(url);
        
        showModal('ุชู ุญูุธ ุงูุฅุฑุดุงุฏุงุช ุจูุฌุงุญ! โ');
    }
    
    function sharePlan() {
        const planText = document.getElementById('result').innerText;
        if (!planText) {
            showModal('ูุง ุชูุฌุฏ ุฅุฑุดุงุฏุงุช ููุดุงุฑูุชูุง. ูุฑุฌู ุฅูุดุงุก ุฎุทุฉ ุฃููุงู.');
            return;
        }

        const shareData = {
            title: 'ุฎุทุชู ูุชุนูู ุงูุฅูุฌููุฒูุฉ ูู ูุบุชู ุงูุซุงููุฉ.',
            text: planText.substring(0, 200) + '...',
            url: window.location.href
        };
        
        if (navigator.share) {
            navigator.share(shareData).catch(err => console.log('Error sharing:', err));
        } else {
            // Fallback - copy link
            navigator.clipboard.writeText(window.location.href).then(() => {
                showModal('ุชู ูุณุฎ ุฑุงุจุท ุงูุตูุญุฉ! ููููู ูุดุงุฑูุชู ูุน ุงูุขุฎุฑูู ๐');
            });
        }
    }
    
    // ==================== Initialization on Load ====================
    
    document.addEventListener('DOMContentLoaded', function() {
        // Set current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Add event listener for the form
        document.getElementById('learning-form').addEventListener('submit', function(e) {
            e.preventDefault();
            generatePlan();
        });
        
        // Event listeners for buttons
        document.getElementById('reset-btn').addEventListener('click', () => {
            showModal('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌุ', [
                { label: 'ูุนูุ ุฃุนุฏ ุงูุชุนููู', class: 'bg-red-600 text-white', callback: performReset },
                { label: 'ุฅูุบุงุก', class: 'bg-gray-200 text-gray-800', callback: () => {} }
            ]);
        });
        document.getElementById('save-btn').addEventListener('click', savePlan);
        document.getElementById('print-btn').addEventListener('click', () => window.print());
        document.getElementById('share-btn').addEventListener('click', sharePlan);

        // Event listeners for hours slider and input
        document.getElementById('hours-slider').addEventListener('input', (e) => updateHoursDisplay(e.target.value));
        document.getElementById('hours').addEventListener('input', (e) => updateHoursSlider(e.target.value));

        // Load saved guidance if available
        const savedGuidance = localStorage.getItem('englishLearningGuidance');
        if (savedGuidance) {
            const guidanceData = JSON.parse(savedGuidance);
            const daysSince = Math.floor((new Date() - new Date(guidanceData.createdAt)) / (1000 * 60 * 60 * 24));
            
            if (daysSince < 30) {
                 showModal(`ูุฏูู ุฅุฑุดุงุฏุงุช ูุญููุธุฉ ููุฐ ${daysSince} ููู. ูู ุชุฑูุฏ ุงุณุชุนุงุฏุชูุงุ`, [
                    { 
                        label: 'ูุนูุ ุงุณุชุนุฏูุง', 
                        class: 'bg-primary text-white', 
                        callback: () => {
                            document.getElementById('level').value = guidanceData.level;
                            document.querySelector(`input[name="goal"][value="${guidanceData.goal}"]`).checked = true;
                            document.getElementById('hours').value = guidanceData.hours;
                            updateHoursSlider(guidanceData.hours);
                            updateHoursDisplay(guidanceData.hours);
                        } 
                    },
                    { label: 'ูุงุ ุงุจุฏุฃ ูู ุฌุฏูุฏ', class: 'bg-gray-200 text-gray-800', callback: () => {} }
                ]);
            }
        }
        
        // Initialize elements
        updateHoursDisplay(5);
        updateHoursSlider(5);
        
        // Track progress on form interaction
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', function() {
                let step = 0;
                if (document.getElementById('level').value) step++;
                if (document.querySelector('input[name="goal"]:checked')) step++;
                if (document.getElementById('hours').value) step++;
                updateProgressBar(step);
            });
        });
    });
    </script>
</body>
</html>
